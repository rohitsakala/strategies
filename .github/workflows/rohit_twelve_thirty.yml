name: Test_Rohit_Twelve_Thirty

on:
  push:
    branches: [ master ]
  schedule:
    - cron:  '30 6 * * *'

env:
  EMAIL_ADDRESS:  ${{ secrets.EMAIL_ADDRESS }}
  EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
  MONGO_URL: ${{ secrets.MONGO_URL }}
  KITE_URL: ${{ secrets.KITE_URL }}
  KITE_USERID: ${{ secrets.KITE_USERID }}
  KITE_PASSWORD: ${{ secrets.KITE_PASSWORD }}
  KITE_PIN: ${{ secrets.KITE_PIN }}
  KITE_APIKEY: ${{ secrets.KITE_APIKEY }}
  KITE_APISECRET: ${{ secrets.KITE_APISECRET }}
  TWELVE_THIRTY_LOT_QUANTITY: ${{ secrets.TWELVE_THIRTY_LOT_QUANTITY }}

jobs:
  build:
    runs-on: self-hosted
    steps:
    - uses: actions/checkout@v2
    - run: |
        wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add - 
        sudo sh -c 'echo "deb https://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
        sudo apt-get update
        sudo apt-get install google-chrome-stable unzip -y
        sudo snap install go --classic
        wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc | sudo apt-key add -
        echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/5.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list
        sudo apt-get update
        sudo apt-get install -y mongodb-org
    - uses: nanasess/setup-chromedriver@master
    - run: |
        chromedriver --url-base=/wd/hub --port=8080 &
    - name: Run 12:30 pm Strategy
      run: go run main.go twelvethirty
